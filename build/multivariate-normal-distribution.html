        <!doctype html>
            <html lang="ja">
            <head><meta charset="UTF-8"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-164492761-1"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "UA-164492761-1");</script><title>Memorandum</title><link rel="stylesheet" href="../css/reset.css"><link rel="stylesheet" href="../css/style.css"><link rel="stylesheet" href="../css/vs.css"><script src="../js/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous" onload="renderMathInElement(document.body, {delimiters: [{left: '$$', right: '$$', display: true}, {left: '$', right: '$', display: false}]});"></script><script src="https://unpkg.com/mermaid@8.5.2/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true,flowchart:{nodeSpacing:20,rankSpacing:20,curve:"basis"}})</script></head>
            <body>
                <div class="container">
                    <header class="header">
    <h1 class="logo">
        <a href="/">Memorandum</a>
    </h1>
    <p class="desc">Ktakuyaのブログ</a>
</header>

                    <hr class="border">
                    <main class="main">
                        <div class="article-wrapper">
                            <div class="header">
                                <h2 class="title">多変量正規分布について</h2>
                                <p class="date">2020-04-26</h2>
                            </div>
                            <div class="content">
                                <p class="content-paragraph">多変量正規分布をいじる機会があったのだが、あまりにもその取り扱い方法を忘れてしまっていたので一度復習しておこうと思う。</p>

<h1 class="section-title">定義</h1>

<p class="content-paragraph">まずは定義から。もっとも普通な、細かく言えば非退化な、正規分布だけを取り扱うことにする。</p>

<div class="content-def"><p><span class="content-def-name">多変量正規分布</span></p><p class="content-paragraph">実$N$次元列ベクトル$\bm{x}$が、多変量正規分布$\mathcal{N}(\bm{\mu}, \bm{\Sigma})$に従うとは、その確率密度関数$p(\bm{x})$が</p>
$$p(\bm{x}) = \frac{1}{\sqrt{(2\pi)^N |\bm{\Sigma}|}} \exp(-\frac{1}{2}(\bm{x} - \bm{\mu})^T \bm{\Sigma}^{-1} (\bm{x} - \bm{\mu}))$$
<p class="content-paragraph">であることを指す。ただしここで、$\bm{\mu}$は、$\bm{x}$同様、$N$次元実ベクトルであり、$\bm{\Sigma}$は正定値行列である。</p></div>

<p class="content-paragraph">太文字をつかった行列表示は実際に紙に書いたときに太文字とそうでないもの字が見分けづらいので、自分は可能なら添字表記の方を使うのだが、今回は行列演算が多いと見ているので太文字の行列で書いたほうがわかりやすくなりそう。</p>

<h1 class="section-title">積分して$1$になること</h1>

<p class="content-paragraph">まずは当たり前だが積分したら合計が$1$になることを確かめたい。久しぶりに多変量正規分布の積分をやったが、とりあえず実直に計算していけば辿り着ける感じのものでもないので少し困った。変数の数が1個や2個の場合なら単純に計算をしていくだけでなんとかなるのだが、任意の$N$に対して同じ方法で計算しようと思うと大変なことになる。</p>

<p class="content-paragraph">鍵は$\bm{\Sigma}$を固有値分解すること。正定値行列なので、固有値は次元数分存在して、それらは全て正の値をとる。</p>
$$\lambda_1, \lambda_2, \cdots, \lambda_N > 0$$
<p class="content-paragraph">そして、これらを対角成分として持つ行列$\bm{\Lambda}$と、直行行列$\bm{V}$が存在して</p>
$$\bm{\Sigma} = \bm{V}^T \bm{\Lambda} \bm{V}$$
<p class="content-paragraph">と分解できることになる。ここまで書いてきて行列は太字で書くのだったか曖昧になり始めたが、ここら辺の定義を書く際に参考にしたWikipediaさんがそう書いているので、その慣習に倣って全部太文字にしていく。</p>

<p class="content-paragraph">固有値分解さえしてしまえば、あとは実直に計算していくだけなはず。長い長い計算の始まり。</p>
$$\begin{aligned}
\int d\bm{x} p(\bm{x}) &= \int d\bm{x} \frac{1}{\sqrt{(2\pi)^N |\bm{\Sigma}|}} \exp(-\frac{1}{2}(\bm{x} - \bm{\mu})^T \bm{\Sigma}^{-1} (\bm{x} - \bm{\mu})) \\
&= \frac{1}{\sqrt{(2\pi)^N |\bm{\Sigma}|}} \int d\bm{x}  \exp(-\frac{1}{2}\bm{x}^T \bm{\Sigma}^{-1} \bm{x}) \\
&= \frac{1}{\sqrt{(2\pi)^N |\bm{\Lambda}|}} \int d\bm{x}  \exp(-\frac{1}{2}\bm{x}^T \bm{V}^T \bm{\Lambda}^{-1} \bm{V} \bm{x}) \\
&= \frac{1}{\sqrt{(2\pi)^N |\bm{\Lambda}|}} \int d\bm{y}  \exp(-\frac{1}{2}\bm{y}^T \bm{\Lambda}^{-1} \bm{y}) \\
&= \prod_{i=1}^N \frac{1}{\sqrt{2\pi \lambda_i}} \int_{-\infty}^{\infty} dy_i \exp(-\frac{1}{2\lambda_i} y_i^2)
\end{aligned}$$

<p class="content-paragraph">ここまで計算して、ガウス積分の公式を忘れたのでwikipediaからとってくる。ガウス積分における色々な係数がどこに影響するかは以前から必ず忘れていて、毎回検索してしまうのだが、何かいい方法はないか。</p>
$$\int^{\infty}_{-\infty} dx \exp(-\xi x^2) = \sqrt{\frac{\pi}{\xi}}$$
<p class="content-paragraph">これをそのまま使えば</p>
$$\int_{-\infty}^{\infty} dy_i \exp(-\frac{1}{2\lambda_i} y_i^2) = \sqrt{2 \pi \lambda_i}$$
<p class="content-paragraph">なので、</p>
$$\int d\bm{x} p(\bm{x}) = 1$$
<p class="content-paragraph">となりそう。</p>

<h1 class="section-title">積率母関数を求める</h1>

<p class="content-paragraph">平均や分散なども出していきたいところだが、それぞれを別々に計算していくのは面倒なので、一度積率母関数を求めて、そこから計算していくことにする。特性関数と必ず混ざるのだが、特性関数はFourier変換のようなもので虚数が入っていて、積率母関数はLaplace変換のようなもので虚数が入っていない。</p>

<p class="content-paragraph">この計算もさっきと同じく$\bm{\Sigma}$の固有値分解をつかえば行けそうな雰囲気がする。</p>
$$\begin{aligned}
E[\exp(\bm{t}^T \bm{x})] &= \int d\bm{x} \frac{1}{\sqrt{(2\pi)^N |\bm{\Sigma}|}} \exp(\bm{t}^T \bm{x}-\frac{1}{2}(\bm{x} - \bm{\mu})^T \bm{\Sigma}^{-1} (\bm{x} - \bm{\mu})) \\
&= \frac{1}{\sqrt{(2\pi)^N |\bm{\Lambda}|}} \int d\bm{x} \exp(\bm{t}^T \bm{x}-\frac{1}{2}(\bm{x} - \bm{\mu})^T \bm{V}^T \bm{\Lambda}^{-1} \bm{V} (\bm{x} - \bm{\mu}))
\end{aligned}$$
<p class="content-paragraph">だが、次のような変数変換をして</p>
$$\begin{aligned}
\bm{y} &= \bm{V} (\bm{x} - \bm{\mu}) \\
\iff \bm{x} &= \bm{V}^T \bm{y} + \bm{\mu}
\end{aligned}$$
<p class="content-paragraph">整理すると</p>
$$\begin{aligned}
E[\exp(\bm{t}^T \bm{x})] &= \frac{1}{\sqrt{(2\pi)^N |\bm{\Lambda}|}} \int d\bm{y} \exp(\bm{t}^T \bm{V}^T \bm{y} + \bm{t}^T \bm{\mu} -\frac{1}{2}\bm{y}^T \bm{\Lambda}^{-1} \bm{y}) \\
&= \frac{\exp(\bm{t}^T \bm{\mu})}{\sqrt{(2\pi)^N |\bm{\Lambda}|}} \prod_{i=1}^N \int dy_i \exp(-\frac{1}{2\lambda_i} y_i^2 + y_i \sum_{j=1}^N V_{ij} t_j) \\
&= \frac{\exp(\bm{t}^T \bm{\mu})}{\sqrt{(2\pi)^N |\bm{\Lambda}|}} \prod_{i=1}^N \int dy_i \exp(-\frac{1}{2\lambda_i} (y_i - \lambda_i \sum_{j=1}^N V_{ij} t_j)^2 + \frac{\lambda_i}{2} (\sum_{j=1}^N V_{ij} t_j)^2) \\
&= \exp(\bm{t}^T \bm{\mu} + \sum_{i=1}^N \frac{\lambda_i}{2}(\sum_{j=1}^N V_{ij} t_j)^2) \\
&= \exp(\bm{t}^T \bm{\mu} + \frac{1}{2} \bm{t}^T \bm{\Sigma} \bm{t})
\end{aligned}$$
<p class="content-paragraph">となり、それっぽい式を得ることができた。</p>

<h1 class="section-title">平均や共分散など</h1>

<p class="content-paragraph">積分母関数から平均は簡単に求めることができる。</p>
$$\begin{aligned}
E[x_i] &= \left.\frac{\partial}{\partial t_i}\right|_{\bm{t}=\bm{0}} E[\exp(\bm{t}^T\bm{x})] \\
&= \mu_i
\end{aligned}$$
<p class="content-paragraph">より、</p>
$$E[\bm{x}] = \bm{\mu}$$
<p class="content-paragraph">となり期待通り。共分散も似たような感じで、</p>
$$\begin{aligned}
E[x_i x_j] &= \left.\frac{\partial^2}{\partial t_i \partial t_j}\right|_{\bm{t}=\bm{0}} E[\exp(\bm{t}^T\bm{x})] \\
&= \left.\frac{\partial}{\partial t_i}\right|_{\bm{t}=\bm{0}} \exp(\bm{t}^T \bm{\mu} + \frac{1}{2} \bm{t}^T \bm{\Sigma} \bm{t}) (\mu_j + \sum_{k=1}^N \Sigma_{jk} t_k) \\
&= \left[\exp(\bm{t}^T \bm{\mu} + \frac{1}{2} \bm{t}^T \bm{\Sigma} \bm{t}) ((\mu_j + \sum_{k=1}^N \Sigma_{jk} t_k) (\mu_i + \sum_{k=1}^N \Sigma_{ik} t_k) + \Sigma_{ij})\right]_{\bm{t}=\bm{0}} \\
&= \Sigma_{ij} + \mu_i \mu_j
\end{aligned}$$
<p class="content-paragraph">より、</p>
$$E[(x_i-\mu_i)(x_j-\mu_j)] = \Sigma_{ij}$$
<p class="content-paragraph">となって期待通り。和の記号と分散の$\Sigma$が近くに配置されてしまって少し式が見にくくなってしまったので、もしかすると別の記号を使っていたほうが見やすくなった感とも思った。ただし一変数の時の分散が$\sigma^2$などと表されているのと統一されてはいるので、どちらを取るかは微妙なところ。</p>
                            </div>
                        </div>
                    </main>
                    <hr class="border">
                    <footer class="footer">
    <p class="copyright">Copyright@2021 Ktakuya. All rights reserved.</p>
</footer>

                </div>
            </body>
        </html>
