# 多項ロジットモデルとガンベル分布

計量経済学でよく現れる離散選択モデルというもの、多くの論文では読者はそれを十分に知り尽くしていることが前提となっているような気がしてくる書き方の論文をよく見る。残念ながら自分は計量経済学をまともに学んだことはないので、とりあえず一つひとつ学んでいっているところだ。今回はその中でも離散選択モデルについてまとめていく。特には多項ロジットモデルとガンベル分布の関係についてまとめていこうと思う。このモデルの妥当性を自分はよく知らないのだが、とりあえず次のようなモデル化をよく見る。

## 多項ロジットモデルとガンベル分布の関係

ある人がいくつかの選択肢$\{1, 2, \cdots, N\}$から一つ選択する状況を考える。例えば食堂でどの定食を頼もうかと考えている時、その人は選べる定食メニューの中から一つを選択するという行為を行う。この時彼らがどのようにその選択を行なっているかを次のようにモデル化するのが離散選択モデルである。

まず彼らはそれぞれの選択肢に対し基本的な選好$V_i \in \mathbb{R}$を持っていると仮定する。基本的にその人はその選好の値が大きいものを選択すると仮定する。次にその人の選好にはブレまたはノイズがあると仮定しそのノイズを確率変数$\epsilon_i \in \mathbb{R}$としてモデル化する。食堂での例を続ければ、基本的な選好$V_i$は各メニューに対する平均的な選好を表し、ノイズ$\epsilon_i$はその食堂に来た時それぞれでの体調や気分によって左右されるような要素を表す。彼らはそれらを合わせた選好がもっとも大きい選択肢を選択すると仮定する。

このようなモデル化をする際、ノイズ項$\epsilon_i$の従う分布として[ガンベル分布](https://en.wikipedia.org/wiki/Gumbel_distribution)と呼ばれるものがよく使用されているのを見かける。ガンベル分布は$x$を変数とする次の確率密度関数を持つ確率分布であり、どうもある条件に当てはまるiidの分布集合の最小値の分布はこれに近づいていくらしい。

$$
\begin{aligned}
f(x) &= \frac{1}{\beta} \exp(-z - e^{-z}) \\
z &= (x - \mu) / \beta
\end{aligned}
$$


このような分布を仮定すると選択肢$i \in \{1, 2, \cdots, N\}$の選択確率が次のようになることが知られている。

$$
P_i = \frac{\exp(V_i)}{\sum_i \exp(V_i)}
$$


この形は経済の方面では多項ロジット分布と呼ばれている分布、機械学習の方面ではsoftmaxと呼ばれている分布で、解析計算との相性がとても良いことが知られている。このような選択確率になってくれることがあり違いことはよくわかるのでガンベル分布自体に正当性があるのかはよく知らないが、たとえなくても使いたいものであることはわかる。

## 選択確率の導出

経済の論文などだとやはり多項ロジットモデルがガンベル分布から導出できるという点はよく知られているようで、論文を適当に見ていても成り立つのは自明みたいに書かれてしまっている。と言われても自分は知らないのでとりあえず証明してみる。変に計算を複雑にしないように、ガンベル分布は最も単純な場合$\beta = 1, \mu = 0$の場合で示す。

まず事前準備としてガンベル分布の累積分布を計算しようと思う。計算は計算なので機械的にやれば良い。

$$
\begin{aligned}
F(a) &= \int^a_{-\infty} \frac{1}{\beta}\exp(-z - e^{-z}) dx \\
&= \int^{(a-\mu)/\beta}_{-\infty}\exp(-z - e^{-z}) dz \\
&= \int^{\infty}_{e^{-(a-\mu)/\beta}} e^{-y} dy \\
&= [-e^{-y}]^{\infty}_{e^{-(a-\mu)/\beta}} \\
&= \exp(- e^{-(a-\mu)/\beta})
\end{aligned}
$$


ただしここで変数変換$y = e^{-z}$を途中で使用している。

ある選択肢$i$が選ばれるためには、その選択肢の選好がノイズを含めて他の全ての選択肢よりも大きくなければならない。全ての選択肢に対する選好$V_1, V_2, \cdots, V_N$と選択肢$i$に対するノイズ$\epsilon_i$が与えられた時、選択肢$j \ne i$が選ばれない確率は

$$
V_j + \epsilon_j < V_i + \epsilon_i \iff \epsilon_j < V_i - V_j + \epsilon_i
$$


より、

$$
F(V_i - V_j + \epsilon_i)
$$


となる。ノイズ項はそれぞれ独立だと仮定しているため、選択肢$i$以外全ての選好が選択肢$i$よりも低くなる確率は

$$
\prod_{j \ne i} F(V_i - V_j + \epsilon_i)
$$


となる。これはノイズ$\epsilon_i$を固定した場合の話なので、実際には選択肢$i$が選ばれる確率は

$$
P_i = \int d\epsilon_i f(\epsilon_i) \prod_{j \ne i} F(V_i - V_j + \epsilon_i)
$$


となる。あとはこれをゴリゴリ計算するだけ。まずは$\xi = - e^{-\epsilon_i}$と変換して

$$
\begin{aligned}
P_i &= \int^{\infty}_{-\infty} d\epsilon_i f(\epsilon_i) \prod_{j \ne i} F(V_i - V_j + \epsilon_i) \\
&= \int^{\infty}_{-\infty} d\epsilon_i e^{-\epsilon_i} \exp(-e^{-\epsilon_i}) \prod_{j \ne i} \exp(-e^{-\epsilon_i + V_j - V_i}) \\
&= \int^0_{-\infty} d\xi \exp(\xi) \prod_{j \ne i} \exp(e^{V_j - V_i} \xi) \\
&= \int^{0}_{-\infty} d\xi \exp(\xi (1 + \sum_{j \ne i} \exp(V_j - V_i))) \\
&= [\frac{\exp(\xi (1 + \sum_{j \ne i} \exp(V_j - V_i)))}{1 + \sum_{j \ne i} \exp(V_j - V_i)}]^0_{-\infty} \\
&= \frac{1}{1 + \sum_{j \ne i} \exp(V_j - V_i)} \\ &= \frac{\exp(V_i)}{\sum_j \exp(V_j)}
\end{aligned}
$$


確かに多項ロジットになった。

## 参考文献

- [多分バークレーでの講義ノート](https://eml.berkeley.edu/choice2/ch3.pdf)
- [多分東大のオペレーションズリサーチの授業資料](http://www.honma-lab.iis.u-tokyo.ac.jp/OR13/OR2013_logit-model.pdf)
